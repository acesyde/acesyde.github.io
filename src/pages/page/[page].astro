---
import HomeLayout from '../../layouts/HomeLayout.astro';
import ArticleCard from '../../components/ArticleCard.svelte';
import Pagination from '../../components/Pagination.svelte';
import { getCollection } from 'astro:content';

const POSTS_PER_PAGE = 10;
const page = Number(Astro.params.page) || 1;

const allPosts = (await getCollection('posts')).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const startIndex = (page - 1) * POSTS_PER_PAGE;
const endIndex = startIndex + POSTS_PER_PAGE;
const posts = allPosts.slice(startIndex, endIndex);

// Redirect to home if page is 1 or invalid
if (page === 1 || page > totalPages || page < 1) {
  return Astro.redirect('/', 301);
}
---

<HomeLayout>
  <section class="posts-section">
    {posts.length > 0 ? (
      <>
        <div class="posts-list">
          {posts.map((post) => (
            <ArticleCard client:load post={post} />
          ))}
        </div>
        
        <Pagination client:load currentPage={page} totalPages={totalPages} />
      </>
    ) : (
      <p class="no-posts">Aucun article trouv√©.</p>
    )}
  </section>
</HomeLayout>

<style>
  .posts-section {
    padding: var(--spacing-xl) 0;
  }
  
  .posts-list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  
  .no-posts {
    text-align: center;
    color: var(--color-text-secondary);
    padding: var(--spacing-2xl);
  }
</style>
